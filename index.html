<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Brain Lab â€” Teasers & Training</title>
<style>
  :root{
    --bg:#0b0d12;--card:#12151c;--fg:#e9edf5;--muted:#a5adbb;--acc:#7cc9ff;--ok:#6ee7a3;--bad:#ff7a7a;--warn:#ffd36b;--border:#1f2430;
  }
  *{box-sizing:border-box}
  body{margin:0;font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;background:radial-gradient(1200px 800px at 20% -10%, #142034 0%, #0b0d12 55%) fixed;color:var(--fg)}
  .wrap{max-width:980px;margin:0 auto;padding:24px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}
  h1{font-size:22px;margin:0}
  .tabs{display:flex;gap:8px;flex-wrap:wrap}
  .tab{border:1px solid var(--border);background:linear-gradient(180deg,#181c25,#12151c);color:var(--fg);padding:8px 12px;border-radius:12px;cursor:pointer;user-select:none}
  .tab[aria-selected="true"]{outline:2px solid var(--acc);}
  .card{background:linear-gradient(180deg,#151925,#10131b);border:1px solid var(--border);box-shadow:0 10px 30px rgba(0,0,0,.4);border-radius:16px;padding:18px;margin-top:14px}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  button, .btn{background:#1a2030;border:1px solid var(--border);color:var(--fg);padding:10px 14px;border-radius:12px;cursor:pointer}
  button:hover{filter:brightness(1.08)}
  .btn-ghost{background:transparent;border-color:transparent;color:var(--muted)}
  .muted{color:var(--muted)}
  .big{font-size:24px}
  .center{text-align:center}
  .grid{display:grid;gap:12px}
  .two{grid-template-columns:repeat(2,minmax(0,1fr))}
  .three{grid-template-columns:repeat(3,minmax(0,1fr))}
  .four{grid-template-columns:repeat(4,minmax(0,1fr))}
  input[type="text"], input[type="number"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#0f1219;color:var(--fg)}
  .ok{color:var(--ok)}
  .bad{color:var(--bad)}
  .timer{font-variant-numeric:tabular-nums}
  .pill{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:#10131b;color:var(--muted);font-size:12px}
  .hidden{display:none !important}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;background:#0c0f15;border:1px solid var(--border);padding:2px 6px;border-radius:6px}
  .finish{padding:10px;border:1px dashed var(--border);background:#0e1220;border-radius:12px}
  .flash{animation:flash .25s ease-out}
  @keyframes flash{from{transform:scale(1.04);text-shadow:0 0 12px rgba(255,255,255,.08)}to{transform:scale(1);text-shadow:none}}
  @media (max-width:680px){.two,.three,.four{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ðŸ§  Brain Lab</h1>
      <div class="tabs" role="tablist" aria-label="Modes">
        <div class="tab" role="tab" aria-selected="true" data-panel="teasers">Teasers</div>
        <div class="tab" role="tab" aria-selected="false" data-panel="math">Speed Math</div>
        <div class="tab" role="tab" aria-selected="false" data-panel="stroop">Stroop</div>
        <div class="tab" role="tab" aria-selected="false" data-panel="nback">1â€‘Back</div>
        <div class="tab" role="tab" aria-selected="false" data-panel="nmem">Number Memory</div>
      </div>
    </header>

    <!-- TEASERS -->
    <section id="teasers" class="card" role="tabpanel">
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="pill">LinkedInâ€‘style & classic logic â€¢ Solved <span id="teaserSolved">0</span>/<span id="teaserTotal">0</span></div>
          <h2 style="margin:6px 0 0">Brain Teaser</h2>
        </div>
        <div class="row">
          <button id="newTeaser">New</button>
          <button id="markSolved">Mark solved</button>
          <button id="reveal">Reveal</button>
        </div>
      </div>
      <div style="height:8px"></div>
      <div id="teaserQ" class="big"></div>
      <details id="answerBox" class="card" style="margin-top:14px"><summary class="muted">Answer / Hint</summary>
        <div id="teaserA" style="margin-top:8px"></div>
      </details>
    </section>

    <!-- SPEED MATH -->
    <section id="math" class="card hidden" role="tabpanel" aria-hidden="true">
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="pill">30s arithmetic drill â€¢ High score <span id="mathBest">0</span></div>
          <h2 style="margin:6px 0 0">Speed Math</h2>
        </div>
        <div class="row"><button id="mathStart">Start</button><div class="pill timer" id="mathTime">30</div></div>
      </div>
      <div class="center" style="margin-top:10px">
        <div class="big" id="mathQ">Press Start</div>
        <div class="row center" style="justify-content:center;margin-top:10px">
          <input id="mathInput" type="number" inputmode="numeric" placeholder="Answer" style="max-width:220px"/>
          <button id="mathCheck">OK</button>
        </div>
        <div class="muted" style="margin-top:6px">Score: <span id="mathScore">0</span> â€¢ Streak <span id="mathStreak">0</span> â€¢ <span id="mathFeedback"></span></div>
        <div id="mathFinish" class="finish hidden" style="margin-top:10px"></div>
      </div>
    </section>

    <!-- STROOP -->
    <section id="stroop" class="card hidden" role="tabpanel" aria-hidden="true">
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="pill">Name the INK color â€¢ High score <span id="stroopBest">0</span></div>
          <h2 style="margin:6px 0 0">Stroop Test</h2>
        </div>
        <div class="row"><button id="stroopStart">Start</button><div class="pill timer" id="stroopTime">30</div></div>
      </div>
      <div class="center" style="margin-top:10px">
        <div id="stroopWord" class="big" style="font-weight:700;letter-spacing:.5px;">Press Start</div>
        <div id="stroopBtns" class="grid two" style="max-width:520px;margin:12px auto 0"></div>
        <div class="muted" style="margin-top:6px">Score: <span id="stroopScore">0</span> â€¢ Accuracy <span id="stroopAcc">0%</span></div>
        <div id="stroopFinish" class="finish hidden" style="margin-top:10px"></div>
      </div>
    </section>

    <!-- 1-BACK -->
    <section id="nback" class="card hidden" role="tabpanel" aria-hidden="true">
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="pill">Press when current == previous â€¢ High score <span id="nBest">0</span></div>
          <h2 style="margin:6px 0 0">1â€‘Back Letters</h2>
        </div>
        <div class="row"><button id="nStart">Start</button><div class="pill timer" id="nTime">40</div></div>
      </div>
      <div class="center" style="margin-top:10px">
        <div id="nIndex" class="muted" style="margin-bottom:4px">Seq: 0</div>
        <div id="nLetter" class="big" style="font-size:42px;font-weight:700">Press Start</div>
        <div class="row center" style="justify-content:center;margin-top:8px"><button id="nMatch">Match (<span class="kbd">Space</span>)</button></div>
        <div class="muted" style="margin-top:6px">Score: <span id="nScore">0</span> â€¢ Hits <span id="nHits">0</span> â€¢ False <span id="nFalse">0</span></div>
        <div id="nFinish" class="finish hidden" style="margin-top:10px"></div>
      </div>
    </section>

    <!-- NUMBER MEMORY -->
    <section id="nmem" class="card hidden" role="tabpanel" aria-hidden="true">
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="pill">Remember the number â€¢ High score <span id="nmBest">0</span></div>
          <h2 style="margin:6px 0 0">Number Memory</h2>
        </div>
        <div class="row"><button id="nmStart">Start</button></div>
      </div>
      <div class="center" style="margin-top:10px">
        <div id="nmShow" class="big">Press Start</div>
        <div class="row center" style="justify-content:center;margin-top:10px">
          <input id="nmInput" type="text" inputmode="numeric" placeholder="Type the number" style="max-width:260px"/>
          <button id="nmCheck">OK</button>
        </div>
        <div class="muted" style="margin-top:6px">Level: <span id="nmLevel">0</span></div>
        <div id="nmFinish" class="finish hidden" style="margin-top:10px"></div>
      </div>
    </section>

    <p class="muted" style="margin-top:16px">Tip: Use <span class="kbd">Tab</span> to hop inputs. All games are offline, singleâ€‘file.</p>
  </div>

<script>
// ---------- STORAGE
const STORE_KEY = 'brainlab_state_v2';
function loadState(){ try{ return JSON.parse(localStorage.getItem(STORE_KEY)) || {best:{math:0,stroop:0,nback:0,nmem:0}, solved:[]} }catch(e){ return {best:{math:0,stroop:0,nback:0,nmem:0}, solved:[]} }}
function saveState(s){ localStorage.setItem(STORE_KEY, JSON.stringify(s)) }
let STATE = loadState();

// ---------- TEASERS (expanded set)
const TEASERS = [
  {q:"You have three labeled boxes: APPLES, ORANGES, MIXED. All labels are wrong. You may pick one fruit from one box. How do you relabel correctly?", a:"Pick one fruit from the MIXED box. Suppose you pull an apple. Then that box must be APPLES. The box labeled APPLES cannot be apples (labels are wrong) and cannot be mixed, so it must be ORANGES. The remaining box is MIXED."},
  {q:"Two trains start 120 km apart and head toward each other, each at 60 km/h. A bee flies back and forth between them at 90 km/h until the trains meet. Total distance flown?", a:"Time to meet = 120/(60+60)=1 hour. Bee flies 90 km."},
  {q:"A 5â€‘letter code word uses letters A, B, C, D, E exactly once. The third letter is a vowel; B is left of D; A is not adjacent to E. Give one valid word.", a:"One example: B A E C D."},
  {q:"You see 5 hats: 3 black, 2 white. Three people wear one hat each. In order they say: 'I don't know.' 'I don't know.' Third says 'I know.' What color is the third hat?", a:"Black, by elimination: if two whites were visible the first would know immediately. This propagates to the third."},
  {q:"You have 7â€‘ and 11â€‘minute hourglasses. Measure exactly 15 minutes.", a:"Start both. At 7: flip 7. At 11: flip 11 (7 has 3 left). When 7 empties (14): flip 11; after 1 minute = 15."},
  {q:"A number is divisible by 3, ends with 5, and digit sum is 12. What is it?", a:"75."},
  {q:"Five sit round a table. Alex between Bea and Cam. Dan not next to Alex. Eve sits two seats clockwise from Bea. Who sits between Dan and Eve?", a:"Cam, in one valid arrangement: Bea, Alex, Cam, Dan, Eve."},
  {q:"You drop a 1Ã—1Ã—1 cube into a bucket, fill to brim, then remove cube. Overflow, same, or drop?", a:"Drop. Removing cube removes displaced volume."},
  {q:"Pick a prime between 51 and 100 that is one less than a multiple of 6.", a:"Any of 53,59,71,83,89."},
  {q:"Smallest positive integer that leaves remainders 1,2,3 when divided by 2,3,4 respectively?", a:"11 (it's âˆ’1 mod lcm(2,3,4)=12)."},
  // new verbal riddles
  {q:"A man looks at a painting and says, 'Brothers and sisters, I have none, but that man's father is my father's son.' Who is in the painting?", a:"His son."},
  {q:"What 3â€‘letter word completes all: _IGHT (8), _EAD (lead), _ORE (ore) and becomes a new valid word each time?", a:"'L' â†’ LIGHT, LEAD, LORE."},
  {q:"You buy a $10 item. You overpay with a $20 and receive $10 and the item. Later the cashier realizes the $20 was counterfeit and pays the store $20 from their own wallet. Total loss to the cashier?", a:"$20 (they lost a real $20 and the store lost nothing net)."},
  {q:"You have two ropes. Each burns in exactly 60 minutes but not at a consistent rate. How to measure 45 minutes?", a:"Light Rope A at both ends and Rope B at one end. When A finishes (30 min), light the other end of B (15 more) â†’ 45."},
  {q:"Which weighs more: a kilo of feathers or a kilo of steel?", a:"Same mass; volume differs."},
  {q:"You meet two guards: one always lies, one always tells truth. One door leads to freedom. One question to ask one guard?", a:"Ask either: 'Which door would the other say is freedom?' Then go the other way."},
  {q:"A farmer needs to take a fox, a chicken, and grain across a river with a boat that holds one item at a time. How?", a:"Take chicken; return; take fox; bring chicken back; take grain; return; take chicken."},
  {q:"You have 8 balls, one is heavier, balance scale, find in 2 weighings. How?", a:"Weigh 3 vs 3. If equal, heavier is among remaining 2 â†’ weigh 1 vs 1. Else take heavier group of 3 and weigh 1 vs 1, using logic to find the heavier."},
  {q:"A clock shows 3:15. What is the angle between hour and minute hands?", a:"At 3:15, minute at 90Â°. Hour hand at 97.5Â°. Angle 7.5Â°."}
];
let idx=0; const qEl = document.getElementById('teaserQ'); const aEl = document.getElementById('teaserA');
const solvedEl=document.getElementById('teaserSolved'); const totalEl=document.getElementById('teaserTotal'); totalEl.textContent=TEASERS.length;
function refreshSolved(){ solvedEl.textContent = STATE.solved.length }
function showTeaser(i){const t=TEASERS[i%TEASERS.length]; qEl.textContent=t.q; aEl.textContent=t.a; document.getElementById('answerBox').open=false}
showTeaser(idx); refreshSolved();

document.getElementById('newTeaser').onclick=()=>{idx=(idx+1)%TEASERS.length;showTeaser(idx)};
document.getElementById('reveal').onclick=()=>{document.getElementById('answerBox').open=true}
document.getElementById('markSolved').onclick=()=>{ if(!STATE.solved.includes(idx)){ STATE.solved.push(idx); saveState(STATE); refreshSolved(); } }

// ---------- TABS
const tabs=[...document.querySelectorAll('.tab')];
tabs.forEach(t=>t.addEventListener('click',()=>{
  tabs.forEach(x=>x.setAttribute('aria-selected','false'));
  t.setAttribute('aria-selected','true');
  const panel=t.dataset.panel; [...document.querySelectorAll('section[role="tabpanel"]')].forEach(sec=>{
    const on = sec.id===panel; sec.classList.toggle('hidden',!on); sec.setAttribute('aria-hidden',(!on).toString());
  })
}))

// helpers
function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}

// ---------- SPEED MATH
const mathQ=document.getElementById('mathQ');
const mathInput=document.getElementById('mathInput');
const mathScoreEl=document.getElementById('mathScore');
const mathStreakEl=document.getElementById('mathStreak');
const mathFeedback=document.getElementById('mathFeedback');
const mathTime=document.getElementById('mathTime');
const mathBest=document.getElementById('mathBest'); mathBest.textContent=STATE.best.math;
const mathFinish=document.getElementById('mathFinish');
let mathTimer=null, mathLeft=30, mathScore=0, mathStreak=0, truth=0;
function newMathQ(){
  const ops=['+','-','Ã—','Ã·'];
  const op=ops[randInt(0,ops.length-1)];
  let a=randInt(2,25), b=randInt(2,25);
  if(op==='Ã·'){truth = a; const prod = a*b; mathQ.textContent = `${prod} Ã· ${b}`}
  else if(op==='Ã—'){truth = a*b; mathQ.textContent = `${a} Ã— ${b}`}
  else if(op==='+'){truth = a+b; mathQ.textContent = `${a} + ${b}`}
  else { if(a<b) [a,b]=[b,a]; truth = a-b; mathQ.textContent = `${a} âˆ’ ${b}`}
  mathQ.classList.add('flash'); setTimeout(()=>mathQ.classList.remove('flash'),180);
}
function endMath(){
  clearInterval(mathTimer); mathTimer=null; mathFeedback.textContent='';
  const prevBest = STATE.best.math||0; if(mathScore>prevBest){ STATE.best.math=mathScore; saveState(STATE); mathBest.textContent=STATE.best.math; }
  mathFinish.classList.remove('hidden');
  mathFinish.innerHTML = `Finished! Score <b>${mathScore}</b> â€¢ Best <b>${STATE.best.math}</b> <div style="margin-top:6px"><button onclick="(${startMath.toString()})()">Play again</button></div>`;
  mathQ.textContent='Done';
}
function startMath(){
  mathFinish.classList.add('hidden');
  mathLeft=30; mathScore=0; mathStreak=0; mathScoreEl.textContent='0'; mathStreakEl.textContent='0'; mathTime.textContent='30'; newMathQ(); mathInput.value=''; mathInput.focus();
  if(mathTimer) clearInterval(mathTimer);
  mathTimer=setInterval(()=>{mathLeft--; mathTime.textContent=String(mathLeft); if(mathLeft<=0){endMath()}},1000);
}
function checkMath(){
  const val=Number(mathInput.value);
  if(Number.isFinite(val) && val===truth){mathScore++; mathStreak++; mathFeedback.textContent='âœ”'; mathFeedback.className='ok'; newMathQ()} else {mathStreak=0; mathFeedback.textContent='âœ–'; mathFeedback.className='bad'}
  mathScoreEl.textContent=String(mathScore); mathStreakEl.textContent=String(mathStreak); mathInput.value=''; mathInput.focus()
}

document.getElementById('mathStart').onclick=startMath;
document.getElementById('mathCheck').onclick=checkMath;
mathInput.addEventListener('keydown',e=>{if(e.key==='Enter') checkMath()});

// ---------- STROOP
const COLORS=[
  {name:'RED', css:'#ef4444'},
  {name:'BLUE', css:'#3b82f6'},
  {name:'GREEN', css:'#22c55e'},
  {name:'YELLOW', css:'#eab308'},
  {name:'PURPLE', css:'#a855f7'}
];
const stroopWord=document.getElementById('stroopWord');
const stroopBtns=document.getElementById('stroopBtns');
const stroopScoreEl=document.getElementById('stroopScore');
const stroopAccEl=document.getElementById('stroopAcc');
const stroopTime=document.getElementById('stroopTime');
const stroopBest=document.getElementById('stroopBest'); stroopBest.textContent=STATE.best.stroop;
const stroopFinish=document.getElementById('stroopFinish');
let stroopTimer=null, stroopLeft=30, stroopScore=0, stroopTries=0, stroopAnswer='';
function setupStroopButtons(){stroopBtns.innerHTML=''; COLORS.forEach(c=>{const b=document.createElement('button'); b.textContent=c.name; b.style.borderColor=c.css; b.onclick=()=>pickStroop(c.name); stroopBtns.appendChild(b)})}
function newStroop(){const word=COLORS[Math.floor(Math.random()*COLORS.length)].name; const ink=COLORS[Math.floor(Math.random()*COLORS.length)]; stroopAnswer=ink.name; stroopWord.textContent=word; stroopWord.style.color=ink.css; stroopWord.classList.add('flash'); setTimeout(()=>stroopWord.classList.remove('flash'),180)}
function pickStroop(name){if(!stroopTimer) return; stroopTries++; if(name===stroopAnswer) stroopScore++; stroopScoreEl.textContent=String(stroopScore); stroopAccEl.textContent = `${Math.round(100* (stroopTries?stroopScore/stroopTries:0))}%`; newStroop()}
function endStroop(){
  clearInterval(stroopTimer); stroopTimer=null;
  const prevBest = STATE.best.stroop||0; if(stroopScore>prevBest){ STATE.best.stroop=stroopScore; saveState(STATE); stroopBest.textContent=STATE.best.stroop; }
  stroopFinish.classList.remove('hidden');
  stroopFinish.innerHTML = `Finished! Score <b>${stroopScore}</b> â€¢ Acc <b>${Math.round(100*(stroopTries?stroopScore/stroopTries:0))}%</b> â€¢ Best <b>${STATE.best.stroop}</b> <div style="margin-top:6px"><button onclick="(${startStroop.toString()})()">Play again</button></div>`;
  stroopWord.textContent='Done';
}
function startStroop(){
  stroopFinish.classList.add('hidden');
  stroopLeft=30; stroopScore=0; stroopTries=0; stroopScoreEl.textContent='0'; stroopAccEl.textContent='0%'; stroopTime.textContent='30'; newStroop(); if(stroopTimer) clearInterval(stroopTimer); stroopTimer=setInterval(()=>{stroopLeft--; stroopTime.textContent=String(stroopLeft); if(stroopLeft<=0) endStroop()},1000)
}
setupStroopButtons();
document.getElementById('stroopStart').onclick=startStroop;

// ---------- 1-BACK
const LETTERS = 'ABCDEFGHJKLMNPQRSTUVWXZ'.split(''); // avoid I/O/Y/0
const nLetter = document.getElementById('nLetter');
const nTime   = document.getElementById('nTime');
const nScoreEl= document.getElementById('nScore');
const nHits   = document.getElementById('nHits');
const nFalse  = document.getElementById('nFalse');
const nBest   = document.getElementById('nBest'); nBest.textContent = STATE.best.nback;
const nFinish = document.getElementById('nFinish');
const nIndex  = document.getElementById('nIndex');

let nTimer=null, seq=[], targetPos=new Set(), seqIdx=0, allow=false;
let nScore=0, nHit=0, nFalseC=0, totalTargets=0;

function makeNBackSequence(len=30, targets=8){
  const s = new Array(len);
  targetPos = new Set();

  // choose target indices from 1..len-1 (positions that can repeat previous)
  const pool = [...Array(len-1).keys()].map(i=>i+1);
  for(let i=pool.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [pool[i],pool[j]]=[pool[j],pool[i]]; }
  const picks = new Set(pool.slice(0, targets));

  s[0] = LETTERS[Math.floor(Math.random()*LETTERS.length)];
  for (let i=1;i<len;i++){
    if(picks.has(i)){ s[i]=s[i-1]; targetPos.add(i); }
    else{
      let c; do{ c = LETTERS[Math.floor(Math.random()*LETTERS.length)] } while(c===s[i-1]);
      s[i]=c;
    }
  }
  totalTargets = targetPos.size; // safety
  return s;
}

function stepN(){
  if(seqIdx>=seq.length){ endN(); return; }
  nIndex.textContent = `Seq: ${seqIdx+1} / ${seq.length} â€¢ Targets this run: ${totalTargets}`;
  nLetter.textContent = seq[seqIdx];
  nLetter.classList.add('flash'); setTimeout(()=>nLetter.classList.remove('flash'),180);
  allow = true;
  nTime.textContent = String(seq.length - seqIdx - 1); // seconds left (1 item/sec)
  seqIdx++;
}

function pressMatch(){
  if(!nTimer || !allow) return;
  const isTarget = targetPos.has(seqIdx-1); // current item index is seqIdx-1
  if(isTarget){ nScore++; nHit++; } else { nScore = Math.max(0, nScore-1); nFalseC++; }
  nScoreEl.textContent = String(nScore);
  nHits.textContent = String(nHit);
  nFalse.textContent = String(nFalseC);
  allow = false;
}

function endN(){
  clearInterval(nTimer); nTimer=null; allow=false;
  const misses = Math.max(0, totalTargets - nHit);
  if(nHit > (STATE.best.nback||0)){ STATE.best.nback = nHit; saveState(STATE); nBest.textContent = STATE.best.nback; }
  nFinish.classList.remove('hidden');
  nFinish.innerHTML = `Finished! Hits <b>${nHit}</b> / ${totalTargets} â€¢ Missed <b>${misses}</b> â€¢ False <b>${nFalseC}</b> â€¢ Best hits <b>${STATE.best.nback}</b>
    <div style="margin-top:6px"><button onclick="(${startN.toString()})()">Play again</button></div>`;
  nLetter.textContent='Done';
}

function startN(){
  nFinish.classList.add('hidden');
  // Comparable: fixed length & target count. Double speed: 1 item/sec.
  seq = makeNBackSequence(30, 8); // 30 items, exactly 8 targets
  seqIdx=0; nScore=0; nHit=0; nFalseC=0; allow=false;
  nScoreEl.textContent='0'; nHits.textContent='0'; nFalse.textContent='0';
  if(nTimer) clearInterval(nTimer);
  stepN();                                // first immediately
  nTimer = setInterval(stepN, 1000);      // then every 1s
}

document.getElementById('nStart').onclick = startN;
document.getElementById('nMatch').onclick = pressMatch;
window.addEventListener('keydown', e => { if(e.code==='Space'){ e.preventDefault(); pressMatch(); } });


// ---------- NUMBER MEMORY
const nmShow=document.getElementById('nmShow');
const nmInput=document.getElementById('nmInput');
const nmLevelEl=document.getElementById('nmLevel');
const nmBestEl=document.getElementById('nmBest'); nmBestEl.textContent=STATE.best.nmem;
const nmFinish=document.getElementById('nmFinish');
let nmLevel=0, nmCurrent='';
function randDigits(n){ let s=''; for(let i=0;i<n;i++) s+=String(Math.floor(Math.random()*10)); return s }
function nmStart(){ nmFinish.classList.add('hidden'); nmLevel=1; nmLevelEl.textContent='1'; nmNext() }
function nmNext(){ nmCurrent = randDigits(nmLevel); nmShow.textContent=nmCurrent; nmShow.classList.add('flash'); setTimeout(()=>{nmShow.textContent='â€¦';}, 900); nmInput.value=''; nmInput.focus() }
function nmCheck(){ const ok = nmInput.value.trim()===nmCurrent; if(ok){ nmLevel++; nmLevelEl.textContent=String(nmLevel); nmNext() } else { const bestPrev=STATE.best.nmem||0; const achieved = Math.max(1, nmLevel-1); if(achieved>bestPrev){ STATE.best.nmem=achieved; saveState(STATE); nmBestEl.textContent=STATE.best.nmem } nmFinish.classList.remove('hidden'); nmFinish.innerHTML=`Finished! Level reached <b>${achieved}</b> â€¢ Best <b>${STATE.best.nmem}</b> <div style="margin-top:6px"><button onclick="(${nmStart.toString()})()">Play again</button></div>`; nmShow.textContent='Done' }
}

document.getElementById('nmStart').onclick=nmStart;
document.getElementById('nmCheck').onclick=nmCheck;
nmInput.addEventListener('keydown',e=>{if(e.key==='Enter') nmCheck()});
</script>
</body>
</html>
